generator client {
  provider = "prisma-client-js"
}

generator erd {
  provider = "prisma-erd-generator"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Categoria {
  id           Int            @id @default(autoincrement())
  descricao    String
  materiaPrima MateriaPrima[]
  produto      ProdutoFinal[]
}

model ProdutoFinal {
  id             Int            @id @default(autoincrement())
  descricao      String
  unidade_medida String
  categoriaId    Int
  etapa          Etapa[]
  loteProduto    LoteProduto[]
  materiaPrima   MateriaPrima[]
  ordens         Ordem[]
  categoria      Categoria      @relation(fields: [categoriaId], references: [id])
}

model MateriaPrima {
  id             Int           @id @default(autoincrement())
  descricao      String
  unidade_medida String
  preco_custo    Float
  imagem         String?
  categoriaId    Int
  produtoFinalId Int
  loteMateria    LoteMateria[]
  categoria      Categoria     @relation(fields: [categoriaId], references: [id])
  produtoFinal   ProdutoFinal  @relation(fields: [produtoFinalId], references: [id])
}

model LoteMateria {
  id                 Int          @id @default(autoincrement())
  numero             String
  quantidade_inicial Float
  quantidade_atual   Float
  data_entrada       DateTime     @default(now()) @db.Timestamp(6)
  fornecedor         String
  materiaPrimaId     Int
  localId            Int
  local              Local        @relation(fields: [localId], references: [id])
  materiaPrima       MateriaPrima @relation(fields: [materiaPrimaId], references: [id])
  ordens             Ordem[]
}

model Local {
  id          Int           @id @default(autoincrement())
  descricao   String
  loteMateria LoteMateria[]
  loteProduto LoteProduto[]
}

model LoteProduto {
  id         Int          @id @default(autoincrement())
  numero     String
  quantidade Int
  imagem     String?
  produtoId  Int
  localId    Int
  ordemId    Int?
  local      Local        @relation(fields: [localId], references: [id])
  Ordem      Ordem?       @relation(fields: [ordemId], references: [id])
  produto    ProdutoFinal @relation(fields: [produtoId], references: [id])
}

model Ordem {
  id                  Int           @id @default(autoincrement())
  numero              String
  data_ordem          DateTime      @default(now()) @db.Timestamp(6)
  quantidade_esperada Int
  status              String
  produtoFinalId      Int
  loteMateriaId       Int
  etapaOrdem          EtapaOrdem[]
  LoteProduto         LoteProduto[]
  loteMateria         LoteMateria   @relation(fields: [loteMateriaId], references: [id])
  produtoFinal        ProdutoFinal  @relation(fields: [produtoFinalId], references: [id])
}

model Etapa {
  id         Int          @id @default(autoincrement())
  descricao  String
  produtoId  Int
  usuarioId  Int?
  produto    ProdutoFinal @relation(fields: [produtoId], references: [id])
  Usuario    Usuario?     @relation(fields: [usuarioId], references: [id])
  etapaOrdem EtapaOrdem[]
}

model EtapaOrdem {
  id                 Int          @id @default(autoincrement())
  status             String
  quantidade_inicial Float
  quantidade_final   Float
  ordemId            Int
  etapaId            Int
  usuarioId          Int
  etapa              Etapa        @relation(fields: [etapaId], references: [id])
  ordem              Ordem        @relation(fields: [ordemId], references: [id])
  usuario            Usuario      @relation(fields: [usuarioId], references: [id])
  ocorrencias        Ocorrencia[]
}

model Ocorrencia {
  id              Int        @id @default(autoincrement())
  titulo          String
  texto           String
  data_ocorrencia DateTime   @default(now()) @db.Timestamp(6)
  imagem          String?
  etapaOrdemId    Int
  etapaOrdem      EtapaOrdem @relation(fields: [etapaOrdemId], references: [id])
}

model Usuario {
  id         Int          @id @default(autoincrement())
  nome       String
  senha      String
  etapas     Etapa[]
  etapaOrdem EtapaOrdem[]
}
